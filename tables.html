<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Working with Tables
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Stuff" />
    <meta name="author" content="Isaac Abraham" />

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet" />

    <link type="text/css" rel="stylesheet" href="./content/style.css" />
    <link type="text/css" rel="stylesheet" href="deedle.css" />
    <script type="text/javascript" src="./content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="masthead">
            <ul class="nav nav-pills pull-right">
                <li><a href="http://fsharp.org">fsharp.org</a></li>
                <li><a href="http://github.com/fsprojects/AzureStorageTypeProvider">github page</a></li>
            </ul>
            <h3 class="muted"><a href="./index.html">Azure Storage Type Provider</a></h3>
        </div>
        <hr />
        <div class="row">
            <div class="span9" id="main">
                
<h1><a name="Working-with-Tables" class="anchor" href="#Working-with-Tables">Working with Tables</a></h1>
<p>For more information on Tables in general, please see some of the many articles on
<a href="https://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.table.aspx">MSDN</a> or the <a href="http://azure.microsoft.com/en-us/documentation/services/storage/">Azure</a> <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-how-to-use-tables/">documentation</a>. Some of the core features of the Tables provider are: -</p>
<h2><a name="Rapid-navigation" class="anchor" href="#Rapid-navigation">Rapid navigation</a></h2>
<p>You can easily move between tables within a storage account. Simply dotting into a Tables property
will automatically retrieve the list of tables in the storage account. This allows
easy exploration of your table assets, directly from within the REPL.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">employeeTable</span> <span class="o">=</span> <span class="i">Azure</span><span class="o">.</span><span class="i">Tables</span><span class="o">.</span><span class="i">employee</span>
<span class="i">printfn</span> <span class="s">&quot;The table is called &#39;%s&#39;.&quot;</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">Name</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>The table is called 'employee'.</code></pre></td></tr></table>
<h2><a name="Automatic-schema-inference" class="anchor" href="#Automatic-schema-inference">Automatic schema inference</a></h2>
<p>Unlike some non-relational data stores, Azure Table Storage <em>does</em> maintain schema information at the
row level in the form of EDM metadata. This can be interrogated in order to infer a table's shape, as
well as help query data. Let's look at the schema of the row <code>fred.1</code> in the <code>employee</code> table.</p>
<div class="deedleframe">
<table>
<thead>
<tr class="header">
<th></th>
<th><p>EDM Data Type</p></th>
<th><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Partition Key</p></td>
<td><p>string</p></td>
<td><p>fred</p></td>
</tr>
<tr class="even">
<td><p>Row Key</p></td>
<td><p>string</p></td>
<td><p>1</p></td>
</tr>
<tr class="odd">
<td><p>Years Worked</p></td>
<td><p>int</p></td>
<td><p>10</p></td>
</tr>
<tr class="even">
<td><p>Dob</p></td>
<td><p>datetime</p></td>
<td><p>01/05/1990</p></td>
</tr>
<tr class="odd">
<td><p>Name</p></td>
<td><p>string</p></td>
<td><p>fred</p></td>
</tr>
<tr class="even">
<td><p>Salary</p></td>
<td><p>double</p></td>
<td><p>0</p></td>
</tr>
<tr class="odd">
<td><p>Is Manager</p></td>
<td><p>bool</p></td>
<td><p>true</p></td>
</tr>
</tbody>
</table>

</div>
<p>Based on this EDM metadata, an appropriate .NET type can be generated and used within the provider.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">printfn</span> <span class="s">&quot;Fred has Partition Key of %s and Row Key of %s&quot;</span> <span class="i">fred</span><span class="o">.</span><span class="i">PartitionKey</span> <span class="i">fred</span><span class="o">.</span><span class="i">RowKey</span>
<span class="i">printfn</span> <span class="s">&quot;Fred has Name &#39;%s&#39;, Years Working &#39;%d&#39;, Dob &#39;%O&#39;, Salary &#39;%f&#39; and Is Manager &#39;%b&#39;.&quot;</span>
    <span class="i">fred</span><span class="o">.</span><span class="i">Name</span> <span class="i">fred</span><span class="o">.</span><span class="i">YearsWorking</span> <span class="i">fred</span><span class="o">.</span><span class="i">Dob</span> <span class="i">fred</span><span class="o">.</span><span class="i">Salary</span> <span class="i">fred</span><span class="o">.</span><span class="i">IsManager</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>Fred has Partition Key of men and Row Key of 1
Fred has Name 'fred', Years Working '10', Dob '01/05/1990 00:00:00', Salary '0.000000' and Is Manager 'true'.</code></pre></td></tr></table>
<h3><a name="Optional-type-generation" class="anchor" href="#Optional-type-generation">Optional type generation</a></h3>
<p>The Storage Type Provider will also intelligently map fields which are not always populated in the table.
For example, given the following rows, we can see that two columns are not always populated.</p>
<div class="deedleframe">
<table>
<thead>
<tr class="header">
<th></th>
<th><p>Timestamp</p></th>
<th><p>Dob</p></th>
<th><p>IsManager</p></th>
<th><p> ... </p></th>
<th><p>Salary</p></th>
<th><p>YearsWorking</p></th>
<th><p>IsAnimal</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>partition.1</p></td>
<td><p>09/11/2017 11:06:10 +00:00</p></td>
<td><p>01/05/1990 00:00:00</p></td>
<td><p>True</p></td>
<td><p> ... </p></td>
<td><p>0</p></td>
<td><p>10</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="even">
<td><p>partition.2</p></td>
<td><p>09/11/2017 11:06:10 +00:00</p></td>
<td><p>01/05/1990 00:00:00</p></td>
<td><p>True</p></td>
<td><p> ... </p></td>
<td><p>0</p></td>
<td><p>N/A</p></td>
<td><p>False</p></td>
</tr>
</tbody>
</table>

</div>
<p>The type provider will correctly infer that YearsWorking and IsAnimal are optional fields are will cascade
this to the type system</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">Azure</span><span class="o">.</span><span class="i">Tables</span><span class="o">.</span><span class="i">optionals</span><span class="o">.</span><span class="i">Get</span>(<span class="i">Row</span> <span class="s">&quot;1&quot;</span>, <span class="i">Partition</span> <span class="s">&quot;partition&quot;</span>)
<span class="o">|&gt;</span> <span class="i">Option</span><span class="o">.</span><span class="i">iter</span>(<span class="k">fun</span> <span class="i">row</span> <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;IsAnimal has a value: %b, YearsWorking value: %A&quot;</span> <span class="i">row</span><span class="o">.</span><span class="i">IsAnimal</span><span class="o">.</span><span class="i">IsSome</span> <span class="i">row</span><span class="o">.</span><span class="i">YearsWorking</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>IsAnimal has a value: false, YearsWorking value: Some 10</code></pre></td></tr></table>
<p>Of course, all other fields remain mandatory. This will also cascade to the provider constructor for the type -
optional fields will become optional constructor arguments. The type provider will download the first 10 rows by default
to infer schema for each table, but this can be increased during creation of the type provider. Obviously, a large
sample increases the chance of the type provider correctly inferring option fields - but if you use a local development
storage account for development purposes, you can probably manually generate a few rows to guide the inference system.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Uses first twenty rows of each table for schema inference.</span>
<span class="k">type</span> <span class="i">FirstTwentyRows</span> <span class="o">=</span> <span class="i">AzureTypeProvider</span><span class="o">&lt;</span><span class="s">&quot;UseDevelopmentStorage=true&quot;</span>, <span class="i">schemaSize</span> <span class="o">=</span> <span class="n">20</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<p>This feature is especially useful when working with <a href="hot-schema-loading.html#Working-with-Tables">hot schema loading</a>. If
new rows are added within the bounds of the schema size, they will be used to re-evaluate the optimal schema automatically.</p>
<h3><a name="Data-Frame-interoperability" class="anchor" href="#Data-Frame-interoperability">Data Frame interoperability</a></h3>
<p>In addition, an extra "Values" property is available which exposes all properties on the entity
in a key/value collection - this is useful for binding scenarios or e.g. mapping in Deedle frames.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">frame</span> <span class="o">=</span>
    <span class="s">&quot;women&quot;</span>
    <span class="o">|&gt;</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">GetPartition</span>
    <span class="o">|&gt;</span> <span class="i">Frame</span><span class="o">.</span><span class="i">ofRecords</span>
    <span class="o">|&gt;</span> <span class="i">Frame</span><span class="o">.</span><span class="i">expandCols</span> [ <span class="s">&quot;Values&quot;</span> ] <span class="c">// expand the &quot;Values&quot; nested column</span>
    <span class="o">|&gt;</span> <span class="i">Frame</span><span class="o">.</span><span class="i">indexRowsUsing</span>(<span class="k">fun</span> <span class="i">c</span> <span class="k">-&gt;</span> <span class="i">sprintf</span> <span class="s">&quot;%O.%O&quot;</span> <span class="i">c</span><span class="o">.</span>[<span class="s">&quot;PartitionKey&quot;</span>] <span class="i">c</span><span class="o">.</span>[<span class="s">&quot;RowKey&quot;</span>]) <span class="c">// Generate a useful row index</span>
    <span class="o">|&gt;</span> <span class="i">Frame</span><span class="o">.</span><span class="i">dropCol</span> <span class="s">&quot;PartitionKey&quot;</span>
    <span class="o">|&gt;</span> <span class="i">Frame</span><span class="o">.</span><span class="i">dropCol</span> <span class="s">&quot;RowKey&quot;</span>
    <span class="o">|&gt;</span> <span class="k">fun</span> <span class="i">f</span> <span class="k">-&gt;</span> <span class="i">f</span> <span class="o">|&gt;</span> <span class="i">Frame</span><span class="o">.</span><span class="i">indexColsWith</span> (<span class="i">f</span><span class="o">.</span><span class="i">ColumnKeys</span> <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">map</span>(<span class="k">fun</span> <span class="i">c</span> <span class="k">-&gt;</span> <span class="i">c</span><span class="o">.</span><span class="i">Replace</span>(<span class="s">&quot;Values.&quot;</span>, <span class="s">&quot;&quot;</span>))) <span class="c">// rename columns to omit &quot;Values.&quot;</span>
</code></pre></td>
</tr>
</table>
<div class="deedleframe">
<table>
<thead>
<tr class="header">
<th></th>
<th><p>Timestamp</p></th>
<th><p>Dob</p></th>
<th><p>IsManager</p></th>
<th><p>Name</p></th>
<th><p>Salary</p></th>
<th><p>YearsWorking</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>women.1</p></td>
<td><p>09/11/2017 11:06:10 +00:00</p></td>
<td><p>30/04/2005 00:00:00</p></td>
<td><p>True</p></td>
<td><p>sara</p></td>
<td><p>3.5</p></td>
<td><p>35</p></td>
</tr>
<tr class="even">
<td><p>women.2</p></td>
<td><p>09/11/2017 11:06:10 +00:00</p></td>
<td><p>20/08/1965 00:00:00</p></td>
<td><p>False</p></td>
<td><p>rachel</p></td>
<td><p>5.5</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>

</div>
<h2><a name="Offline-development" class="anchor" href="#Offline-development">Offline development</a></h2>
<p>In addition to using the Azure Storage Emulator, you can also simply provide the type provider
with a JSON file containing the list of tables and their schema. This is particularly
useful within the context of a CI process, or when you know a specific "known good" structure of
tables within a storage account.</p>
<h3><a name="Overview" class="anchor" href="#Overview">Overview</a></h3>
<p>You can still access blobs using the compile-time storage connection string if provided, or
override as normal at runtime.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">TableSchema</span> <span class="o">=</span> <span class="i">AzureTypeProvider</span><span class="o">&lt;</span><span class="i">tableSchema</span> <span class="o">=</span> <span class="s">&quot;TableSchema.json&quot;</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<p>The contents of <code>TableSchema.json</code> looks as follows.</p>
<table class="pre"><tr><td><pre><code>"{
    "Employee": {
        "Name": {
            "Type": "String"
        },
        "YearsWorking": {
            "Type": "int32"
        },
        "Dob": {
            "Type": "DateTime"
        },
        "Salary": {
            "Type": "double",
            "Optional": true
        },
        "IsManager": {
            "Type": "boolean",
            "Optional": true
        }
    }
}"</code></pre></td></tr></table>
<p>We can access the data just as normal - the only difference is that the schema is defined
by the json file rather than inferred from a set of data.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">staticFred</span> <span class="o">=</span> <span class="i">TableSchema</span><span class="o">.</span><span class="i">Tables</span><span class="o">.</span><span class="i">Employee</span><span class="o">.</span><span class="i">Get</span>(<span class="i">Row</span> <span class="s">&quot;1&quot;</span>, <span class="i">Partition</span> <span class="s">&quot;men&quot;</span>)<span class="o">.</span><span class="i">Value</span>
<span class="i">printfn</span> <span class="s">&quot;Fred has Salary &#39;%A&#39;, Is Manager &#39;%A&#39;.&quot;</span> <span class="i">staticFred</span><span class="o">.</span><span class="i">Salary</span> <span class="i">staticFred</span><span class="o">.</span><span class="i">IsManager</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>Fred has Salary 'Some 0.0', Is Manager 'Some true'.</code></pre></td></tr></table>
<p>Notice that both Salary and IsManager are rendered as option types, since we've explicitly
marked them as such in the schema definition file. Compare this to the earlier sample, where
the type provider inferred types based on the first n rows, where they were rendered as
mandatory types.</p>
<h3><a name="Supported-data-types" class="anchor" href="#Supported-data-types">Supported data types</a></h3>
<p>The list of types available are limited by those supported by Azure Tables: -</p>
<div class="deedleframe">
<table>
<thead>
<tr class="header">
<th></th>
<th><p>Value in JSON config</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>EdmType.Binary</p></td>
<td><p>binary</p></td>
</tr>
<tr class="even">
<td><p>EdmType.Boolean</p></td>
<td><p>boolean</p></td>
</tr>
<tr class="odd">
<td><p>EdmType.DateTime</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="even">
<td><p>EdmType.Double</p></td>
<td><p>double</p></td>
</tr>
<tr class="odd">
<td><p>EdmType.Guid</p></td>
<td><p>guid</p></td>
</tr>
<tr class="even">
<td><p>EdmType.Int32</p></td>
<td><p>int32</p></td>
</tr>
<tr class="odd">
<td><p>EdmType.Int64</p></td>
<td><p>int64</p></td>
</tr>
<tr class="even">
<td><p>EdmType.String</p></td>
<td><p>string</p></td>
</tr>
</tbody>
</table>

</div>
<h2><a name="Querying-data" class="anchor" href="#Querying-data">Querying data</a></h2>
<p>The storage provider has an easy-to-use query API that is also flexble and powerful, and uses the
inferred schema to generate the appropriate query functionality. Data can be queried in several
ways, in both synchronous or asynchronous forms.</p>
<h3><a name="Key-Lookups" class="anchor" href="#Key-Lookups">Key Lookups</a></h3>
<p>These are the simplest (and best performing) queries, based on a partition / row key combination,
returning an optional result. You can also retrieve an entire partition.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">sara</span> <span class="o">=</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">Get</span>(<span class="i">Row</span> <span class="s">&quot;1&quot;</span>, <span class="i">Partition</span> <span class="s">&quot;women&quot;</span>) <span class="c">// try to get a single row</span>
<span class="k">let</span> <span class="i">allWomen</span> <span class="o">=</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">GetPartition</span>(<span class="s">&quot;women&quot;</span>) <span class="c">// get all rows in the &quot;women&quot; partition</span>
<span class="k">let</span> <span class="i">allWomenAsync</span> <span class="o">=</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">GetPartitionAsync</span> <span class="s">&quot;women&quot;</span> <span class="o">|&gt;</span> <span class="i">Async</span><span class="o">.</span><span class="i">RunSynchronously</span> <span class="c">// As above but async version</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Plain-Text-Queries" class="anchor" href="#Plain-Text-Queries">Plain Text Queries</a></h3>
<p>If you need to search for a set of entities, you can enter a plain text search, either manually or
using the Azure SDK query builder.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// create the query string by hand</span>
<span class="k">let</span> <span class="i">someData</span> <span class="o">=</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">Query</span>(<span class="s">&quot;YearsWorking eq 35&quot;</span>)
<span class="i">printfn</span> <span class="s">&quot;The query returned %d rows.&quot;</span> <span class="i">someData</span><span class="o">.</span><span class="i">Length</span>

<span class="c">// generate a query string programmatically.</span>
<span class="k">let</span> <span class="i">filterQuery</span> <span class="o">=</span>
    <span class="i">TableQuery</span><span class="o">.</span><span class="i">GenerateFilterConditionForInt</span>(<span class="s">&quot;YearsWorking&quot;</span>, <span class="i">QueryComparisons</span><span class="o">.</span><span class="i">Equal</span>, <span class="n">35</span>)
<span class="i">printfn</span> <span class="s">&quot;Generated query is &#39;%s&#39;&quot;</span> <span class="i">filterQuery</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>The query returned 2 rows.
Generated query is 'YearsWorking eq 35'</code></pre></td></tr></table>
<h3><a name="Query-DSL" class="anchor" href="#Query-DSL">Query DSL</a></h3>
<p>A third alternative to querying with the Azure SDK is to use the LINQ IQueryable implementation.
This works in F# as well using the <code>query { }</code> computation expression. However, this
implementation has two main limitations: -
- You need to manually create a type to handle the result
- IQueryable does not guarantee runtime safety for a query that compiles. This is particularly
evident with the Azure Storage Tables, which allow a very limited set of queries.</p>
<p>The Table provider allows an alternative that has the same sort of composability of IQueryable, yet
is strongly typed at compile- and runtime, whilst being extremely easy to use. It generates query
methods appropriate for each property on the entity, including appropriate clauses e.g. Greater
Than, Less Than etc. as supported by the Azure Storage Table service</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">tpQuery</span> <span class="o">=</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">Query</span>()<span class="o">.</span><span class="i">``Where Years Working Is``</span><span class="o">.</span><span class="i">``Equal To``</span>(<span class="n">35</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>["YearsWorking eq 35"]</code></pre></td></tr></table>
<p>These can be composed and chained. When you have completed building, simply call <code>Execute()</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">longerQuery</span> <span class="o">=</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">Query</span>()
                       <span class="o">.</span><span class="i">``Where Years Working Is``</span><span class="o">.</span><span class="i">``Greater Than``</span>(<span class="n">14</span>)
                       <span class="o">.</span><span class="i">``Where Name Is``</span><span class="o">.</span><span class="i">``Equal To``</span>(<span class="s">&quot;Fred&quot;</span>)
                       <span class="o">.</span><span class="i">``Where Is Manager Is``</span><span class="o">.</span><span class="i">True</span>()
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>["IsManager eq true"; "Name eq 'Fred'"; "YearsWorking gt 14"]</code></pre></td></tr></table>
<p>Query operators are strongly typed, so <code>Equal To</code> on <code>Years Working</code> takes in an int, whereas
on <code>Name</code> it takes in a string, whilst for booleans there is no such provided method.</p>
<h2><a name="Inserting-data" class="anchor" href="#Inserting-data">Inserting data</a></h2>
<p>Inserting data is extremely easy with Azure Type Provider. A table will always have an Insert
method on it, with various overloads that will appear depending on whether the table has data in
it (and thus a schema could be inferred) or is empty.</p>
<h3><a name="Inserting-single-records" class="anchor" href="#Inserting-single-records">Inserting single records</a></h3>
<p>If the table is newly-created (and has no existing data from which to infer schema), you can insert
data by calling one of the two available Insert overloads. The first one takes a single
PartitionKey, RowKey and any object. It will automatically generate the appropriate Azure Storage
request for all public properties. Conversely, if the table exists and has schema associated with
it, you can use a strongly-typed Insert method. You can also choose whether to insert or upsert
(insert or update) data.</p>
<p>Both mechanisms will also return a TableResponse discriminated union on the outcome of the operation.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">Person</span> <span class="o">=</span> { <span class="i">Name</span> <span class="o">:</span> <span class="i">string</span>; <span class="i">City</span> <span class="o">:</span> <span class="i">string</span> }
<span class="k">let</span> <span class="i">emptyTable</span> <span class="o">=</span> <span class="i">Azure</span><span class="o">.</span><span class="i">Tables</span><span class="o">.</span><span class="i">emptytable</span>

<span class="c">// insert a single row into an empty table</span>
<span class="k">let</span> <span class="i">response</span> <span class="o">=</span> <span class="i">emptyTable</span><span class="o">.</span><span class="i">Insert</span>(<span class="i">Partition</span> <span class="s">&quot;Europe&quot;</span>, <span class="i">Row</span> <span class="s">&quot;1&quot;</span>, { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Isaac&quot;</span>; <span class="i">City</span> <span class="o">=</span> <span class="s">&quot;London&quot;</span> })
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>SuccessfulResponse ((Partition "Europe", Row "1"),204)</code></pre></td></tr></table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">newEmployee</span> <span class="o">=</span>
    <span class="k">new</span> <span class="i">Azure</span><span class="o">.</span><span class="i">Domain</span><span class="o">.</span><span class="i">employeeEntity</span>(
        <span class="i">Partition</span> <span class="s">&quot;women&quot;</span>, <span class="i">Row</span> <span class="s">&quot;3&quot;</span>,
        <span class="i">Dob</span> <span class="o">=</span> <span class="i">DateTime</span>(<span class="n">1979</span>, <span class="n">2</span>, <span class="n">12</span>),
        <span class="i">IsManager</span> <span class="o">=</span> <span class="k">true</span>,
        <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;sophie&quot;</span>,
        <span class="i">Salary</span> <span class="o">=</span> <span class="n">123.</span>,
        <span class="i">YearsWorking</span> <span class="o">=</span> <span class="n">17</span>)
<span class="k">let</span> <span class="i">newEmployeeResponse</span> <span class="o">=</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">Insert</span>(<span class="i">newEmployee</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>SuccessfulResponse ((Partition "women", Row "3"),204)</code></pre></td></tr></table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">upsertResponse</span> <span class="o">=</span> <span class="i">employeeTable</span><span class="o">.</span><span class="i">Insert</span>(<span class="i">newEmployee</span>, <span class="i">TableInsertMode</span><span class="o">.</span><span class="i">Upsert</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>SuccessfulResponse ((Partition "women", Row "3"),204)</code></pre></td></tr></table>
<h3><a name="Inserting-batches" class="anchor" href="#Inserting-batches">Inserting batches</a></h3>
<p>The Storage provider makes it easier to insert large amounts of data by automatically grouping
large datasets into the appropriate batches, which for Azure Tables have to be across the same
partition and in sizes of up to 100 entities. You can insert batches for tables that either
already have schema or do not.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">people</span> <span class="o">=</span> [ <span class="i">Partition</span> <span class="s">&quot;Europe&quot;</span>, <span class="i">Row</span> <span class="s">&quot;2&quot;</span>, { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Tony&quot;</span>; <span class="i">City</span> <span class="o">=</span> <span class="s">&quot;Milan&quot;</span>}
               <span class="i">Partition</span> <span class="s">&quot;North America&quot;</span>, <span class="i">Row</span> <span class="s">&quot;1&quot;</span>, { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Sally&quot;</span>; <span class="i">City</span> <span class="o">=</span> <span class="s">&quot;New York&quot;</span>}
               <span class="i">Partition</span> <span class="s">&quot;North America&quot;</span>, <span class="i">Row</span> <span class="s">&quot;2&quot;</span>, { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Tom&quot;</span>; <span class="i">City</span> <span class="o">=</span> <span class="s">&quot;Chicago&quot;</span>}
               <span class="i">Partition</span> <span class="s">&quot;Europe&quot;</span>, <span class="i">Row</span> <span class="s">&quot;3&quot;</span>, { <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Dirk&quot;</span>; <span class="i">City</span> <span class="o">=</span> <span class="s">&quot;Frankfurt&quot;</span>} ]

<span class="c">// results are grouped by the batch that they were inserted in.</span>
<span class="k">let</span> <span class="i">batchResults</span> <span class="o">=</span> <span class="i">emptyTable</span><span class="o">.</span><span class="i">Insert</span>(<span class="i">people</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>[|("Europe",
   [|SuccessfulResponse ((Partition "Europe", Row "3"),204);
     SuccessfulResponse ((Partition "Europe", Row "2"),204)|]);
  ("North America",
   [|SuccessfulResponse ((Partition "North America", Row "2"),204);
     SuccessfulResponse ((Partition "North America", Row "1"),204)|])|]</code></pre></td></tr></table>
<h2><a name="Deleting-data" class="anchor" href="#Deleting-data">Deleting data</a></h2>
<p>Deleting data is also extremely easy - simply supply the set of Partition / Row Key combinations that
you wish to delete.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">deleteResult</span> <span class="o">=</span> <span class="i">emptyTable</span><span class="o">.</span><span class="i">Delete</span> [ <span class="k">for</span> <span class="i">row</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">2</span> <span class="k">-&gt;</span> <span class="i">Partition</span> <span class="s">&quot;North America&quot;</span>, <span class="i">Row</span> (<span class="i">row</span><span class="o">.</span><span class="i">ToString</span>()) ]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>[|("North America",
   [|SuccessfulResponse ((Partition "North America", Row "2"),204);
     SuccessfulResponse ((Partition "North America", Row "1"),204)|])|]</code></pre></td></tr></table>
<p>Alternatively, you can delete an entire partition (although due to the limitations
of the Table Storage service, this will require loading all row keys for that partition into memory).</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">deletePartitionResult</span> <span class="o">=</span> <span class="i">emptyTable</span><span class="o">.</span><span class="i">DeletePartition</span> <span class="s">&quot;Europe&quot;</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>("Europe",
 [|SuccessfulResponse ((Partition "Europe", Row "3"),204);
   SuccessfulResponse ((Partition "Europe", Row "2"),204);
   SuccessfulResponse ((Partition "Europe", Row "1"),204)|])</code></pre></td></tr></table>
<h2><a name="Error-handling" class="anchor" href="#Error-handling">Error handling</a></h2>
<p>Operations should not raise exceptions. Instead, return codes of any write operations return a
TableResponse. This contains the Partition and Row Keys of the affected row as well as the
associated TableResult, wrapped in a discriminated union to allow easy matching.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">handleResponse</span> <span class="o">=</span>
    <span class="k">function</span>
    | <span class="i">SuccessfulResponse</span>(<span class="i">entityId</span>, <span class="i">errorCode</span>) <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;Entity %A succeeded: %d.&quot;</span> <span class="i">entityId</span> <span class="i">errorCode</span>
    | <span class="i">EntityError</span>(<span class="i">entityId</span>, <span class="i">httpCode</span>, <span class="i">errorCode</span>) <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;Entity %A failed: %d - %s.&quot;</span> <span class="i">entityId</span> <span class="i">httpCode</span> <span class="i">errorCode</span>
    | <span class="i">BatchOperationFailedError</span>(<span class="i">entityId</span>) <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;Entity %A was ignored as part of a failed batch operation.&quot;</span> <span class="i">entityId</span>
    | <span class="i">BatchError</span>(<span class="i">entityId</span>, <span class="i">httpCode</span>, <span class="i">errorCode</span>) <span class="k">-&gt;</span> <span class="i">printfn</span> <span class="s">&quot;Entity %A failed with an unknown batch error: %d - %s.&quot;</span> <span class="i">entityId</span> <span class="i">httpCode</span> <span class="i">errorCode</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Insert an existing entity</span>
<span class="i">employeeTable</span><span class="o">.</span><span class="i">Insert</span>(<span class="i">newEmployee</span>) <span class="o">|&gt;</span> <span class="i">handleResponse</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>Entity (Partition "women", Row "3") failed: 409 - EntityAlreadyExists.</code></pre></td></tr></table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Insert the same batch twice</span>
<span class="i">emptyTable</span><span class="o">.</span><span class="i">Insert</span>(<span class="i">people</span>)
<span class="i">emptyTable</span><span class="o">.</span><span class="i">Insert</span>(<span class="i">people</span>) <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">collect</span> <span class="i">snd</span> <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">iter</span> <span class="i">handleResponse</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>Entity (Partition "Europe", Row "3") failed: 409 - EntityAlreadyExists.
Entity (Partition "Europe", Row "2") was ignored as part of a failed batch operation.
Entity (Partition "North America", Row "2") failed: 409 - EntityAlreadyExists.
Entity (Partition "North America", Row "1") was ignored as part of a failed batch operation.</code></pre></td></tr></table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Delete a non-existant entity</span>
<span class="i">emptyTable</span><span class="o">.</span><span class="i">Delete</span>([ <span class="i">Partition</span> <span class="s">&quot;Foo&quot;</span>, <span class="i">Row</span> <span class="s">&quot;Bar&quot;</span> ]) <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">collect</span> <span class="i">snd</span> <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">iter</span> <span class="i">handleResponse</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>Entity (Partition "Foo", Row "Bar") failed: 404 - ResourceNotFound.</code></pre></td></tr></table>


            </div>
            <div class="span3">
                <img src="./img/logo.png" alt="F# Project" style="width:150px;margin:10px" />
                <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
                    <li class="nav-header">Azure Storage Type Provider</li>
                    <li><a href="./index.html">Home page</a></li>
                    <li class="divider"></li>
                    <li><a href="http://www.nuget.org/packages/FSharp.Azure.StorageTypeProvider">Get Library via NuGet</a></li>
                    <li><a href="http://github.com/fsprojects/AzureStorageTypeProvider">Source Code on GitHub</a></li>
                    <li><a href="http://github.com/fsprojects/AzureStorageTypeProvider/blob/master/LICENSE.txt">License</a></li>
                    <li><a href="http://github.com/fsprojects/AzureStorageTypeProvider/blob/master/RELEASE_NOTES.md">Release Notes</a></li>

                    <li class="nav-header">Getting started</li>
                    <li><a href="./quickstart.html">Quick start</a></li>
                    <li><a href="./blobs.html">Using Azure Blobs</a></li>
                    <li><a href="./tables.html">Using Azure Tables</a></li>
                    <li><a href="./queues.html">Using Azure Storage Queues</a></li>
                    <li><a href="./hot-schema-loading.html">Hot Schema Loading</a></li>

                    <li class="nav-header">Documentation</li>
                    <li><a href="./reference/index.html">API Reference</a></li>
                </ul>
            </div>
        </div>
    </div>
    <a href="http://github.com/fsprojects/AzureStorageTypeProvider"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" /></a>
</body>
</html>
